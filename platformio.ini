
; PlatformIO Project Configuration File
; https://docs.platformio.org/page/projectconf.html
;
; Environments:
;   release  — production build, log_i/w/e visible (CORE_DEBUG_LEVEL=3), log_d() compiled out
;   debug    — development build, all log levels including framework internals (CORE_DEBUG_LEVEL=4)
;
; Usage:
;   pio run -e release -t upload      (default for flashing; milestone log_i output visible)
;   pio run -e debug   -t upload      (verbose serial logging, includes framework debug noise)

; ---------------------------------------------------------------------------
; [env] — shared base: inherited automatically by all [env:*] sections
; ---------------------------------------------------------------------------
[env]
; Core: 3.3.2
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.32/platform-espressif32.zip

; Core: 3.3.7
; platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.37/platform-espressif32.zip

; Core: stable
; platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip

board                   = esp32dev
board_build.partitions  = partitions/DataDisplayCYD.csv
framework               = arduino

upload_port    = /dev/cu.wchusbserial14330
monitor_port   = /dev/cu.wchusbserial14330
monitor_speed  = 115200
monitor_filters = 
    esp32_exception_decoder
upload_protocol = esptool

; Custom targets: `pio run -e release -t merged`  and  `pio run -e release -t ota`
extra_scripts   = scripts/custom_targets.py

lib_deps =
    bodmer/TFT_eSPI@^2.5.43
    bblanchon/ArduinoJson@7.4.2
    paulstoffregen/XPT2046_Touchscreen

build_flags =
    ; Expose include/ to all compilation units (including TFT_eSPI)
    -I $PROJECT_DIR/include
    ; TFT_eSPI: suppress its own setup; inject our config before every TU
    -D USER_SETUP_LOADED
    -include $PROJECT_DIR/include/User_Setup.h

; ---------------------------------------------------------------------------
; release — log_i/w/e active for milestone output; log_d() compiled out
; ---------------------------------------------------------------------------
[env:release]
build_flags =
    ${env.build_flags}
    -D CORE_DEBUG_LEVEL=3
    -Os

; ---------------------------------------------------------------------------
; debug — log_d() active (tag + file + line prefix on every message)
; ---------------------------------------------------------------------------
[env:debug]
build_flags =
    ${env.build_flags}
    -D CORE_DEBUG_LEVEL=4
    -Og -ggdb
    ; Inject a known holiday date to test the full fetch+parse+display path.
    ; Remove or comment out for normal debug builds.
    -D HOLIDAY_TEST_DATE='"2026-12-25"'


;   --- EOF ---
